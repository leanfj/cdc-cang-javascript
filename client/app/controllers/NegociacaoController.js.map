{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacoesView","Mensagem","MensagemView","NegociacaoService","getNegociacaoDao","DataInvalidaException","Negociacao","Bind","DateConverter","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listaTodos","negociacoes","forEach","negociacao","adiciona","catch","err","texto","event","preventDefault","_criaNegociacao","adciona","_limpaformulario","error","console","log","stack","message","toDate","value","parseInt","parseFloat","focus","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals"],"mappings":";;;;;;AAASA,iB,kCAAAA,W;;AACAC,qB,6BAAAA,e;;AACAC,c,uBAAAA,Q;;AACAC,kB,0BAAAA,Y;;AACAC,uB,wCAAAA,iB;;AACAC,sB,qBAAAA,gB;;AACAC,2B,wCAAAA,qB;;AACAC,gB,iCAAAA,U;;AACAC,U,eAAAA,I;;AACAC,mB,gCAAAA,a;;;AAEF,YAAMC,oBAAN,CAA2B;AAChCC,sBAAc;AACZ;AACA;AACA,gBAAMC,IAAIC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAV;;AAEA;AACA,eAAKG,UAAL,GAAkBJ,EAAE,OAAF,CAAlB;AACA,eAAKK,gBAAL,GAAwBL,EAAE,aAAF,CAAxB;AACA,eAAKM,WAAL,GAAmBN,EAAE,QAAF,CAAnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAKO,YAAL,GAAoB,IAAIX,IAAJ,CAClB,IAAIR,WAAJ,EADkB,EAElB,IAAIC,eAAJ,CAAoB,cAApB,CAFkB,EAGlB,UAHkB,EAIlB,SAJkB,CAApB;;AAOA;AACA;AACA;AACA;AACA;;AAEA,eAAKmB,SAAL,GAAiB,IAAIZ,IAAJ,CACf,IAAIN,QAAJ,EADe,EAEf,IAAIC,YAAJ,CAAiB,eAAjB,CAFe,EAGf,OAHe,CAAjB;;AAMA,eAAKkB,QAAL,GAAgB,IAAIjB,iBAAJ,EAAhB;AACA,eAAKkB,KAAL;AACD;AACDA,gBAAQ;AACNjB,6BACGkB,IADH,CACQC,OAAOA,IAAIC,UAAJ,EADf,EAEGF,IAFH,CAEQG,eACJA,YAAYC,OAAZ,CAAoBC,cAClB,KAAKT,YAAL,CAAkBU,QAAlB,CAA2BD,UAA3B,CADF,CAHJ,EAOGE,KAPH,CAOSC,OAAQ,KAAKX,SAAL,CAAeY,KAAf,GAAuBD,GAPxC;AAQD;AACDF,iBAASI,KAAT,EAAgB;AACd,cAAI;AACF;AACAA,kBAAMC,cAAN;;AAEA,kBAAMN,aAAa,KAAKO,eAAL,EAAnB;;AAEA9B,+BACGkB,IADH,CACQC,OAAOA,IAAIY,OAAJ,CAAYR,UAAZ,CADf,EAEGL,IAFH,CAEQ,MAAM;AACV,mBAAKJ,YAAL,CAAkBU,QAAlB,CAA2BD,UAA3B;AACA,mBAAKR,SAAL,CAAeY,KAAf,GAAuB,mCAAvB;AACA,mBAAKK,gBAAL;AACD,aANH;AAOD,WAbD,CAaE,OAAOC,KAAP,EAAc;AACdC,oBAAQC,GAAR,CAAYF,KAAZ;AACAC,oBAAQC,GAAR,CAAYF,MAAMG,KAAlB;AACA,gBAAIH,iBAAiBhC,qBAArB,EAA4C;AAC1C,mBAAKc,SAAL,CAAeY,KAAf,GAAuBM,MAAMI,OAA7B;AACD,aAFD,MAEO;AACL,mBAAKtB,SAAL,CAAeY,KAAf,GACE,gEADF;AAED;AACF;AACF;;AAEDG,0BAAkB;AAChB,iBAAO,IAAI5B,UAAJ,CACLE,cAAckC,MAAd,CAAqB,KAAK3B,UAAL,CAAgB4B,KAArC,CADK,EAELC,SAAS,KAAK5B,gBAAL,CAAsB2B,KAA/B,CAFK,EAGLE,WAAW,KAAK5B,WAAL,CAAiB0B,KAA5B,CAHK,CAAP;AAKD;;AAEDP,2BAAmB;AACjB,eAAKrB,UAAL,CAAgB4B,KAAhB,GAAwB,EAAxB;AACA,eAAK3B,gBAAL,CAAsB2B,KAAtB,GAA8B,CAA9B;AACA,eAAK1B,WAAL,CAAiB0B,KAAjB,GAAyB,GAAzB;AACA,eAAK5B,UAAL,CAAgB+B,KAAhB;AACD;;AAEDC,gBAAQ;AACN3C,6BACGkB,IADH,CACQC,OAAOA,IAAIyB,UAAJ,EADf,EAEG1B,IAFH,CAEQ,MAAM;AACV,iBAAKJ,YAAL,CAAkB+B,OAAlB;AACA,iBAAK9B,SAAL,CAAeY,KAAf,GAAuB,iCAAvB;AACD,WALH,EAMGF,KANH,CAMSC,OAAQ,KAAKX,SAAL,CAAeY,KAAf,GAAuBD,GANxC;AAOD;;AAEDoB,6BAAqB;AACnB;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAK9B,QAAL,CACG+B,yBADH,GAEG7B,IAFH,CAEQG,eAAe;AACnBA,wBACG2B,MADH,CAEIC,kBACE,CAAC,KAAKnC,YAAL,CACEoC,SADF,GAEEC,IAFF,CAEOC,uBACJH,eAAeI,MAAf,CAAsBD,mBAAtB,CAHH,CAHP,EASG9B,OATH,CASWC,cAAc,KAAKT,YAAL,CAAkBU,QAAlB,CAA2BD,UAA3B,CATzB;AAUA,iBAAKR,SAAL,CAAeY,KAAf,GAAuB,+CAAvB;AACD,WAdH,EAeGF,KAfH,CAeSC,OAAQ,KAAKX,SAAL,CAAeY,KAAf,GAAuBD,GAfxC;AAgBD;AAxJ+B","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes } from \"../domain/negociacao/Negociacoes.js\";\nimport { NegociacoesView } from \"../ui/views/NegociacoesView.js\";\nimport { Mensagem } from \"../ui/models/Mensagem.js\";\nimport { MensagemView } from \"../ui/views/MensagemView.js\";\nimport { NegociacaoService } from \"../domain/negociacao/NegociacaoService.js\";\nimport { getNegociacaoDao } from \"../util/DaoFactory.js\";\nimport { DataInvalidaException } from \"../ui/converters/DataInvalidaException.js\";\nimport { Negociacao } from \"../domain/negociacao/Negociacao.js\";\nimport { Bind } from \"../util//Bind.js\";\nimport { DateConverter } from \"../ui/converters/DateConverter.js\";\n\nexport class NegociacaoController {\n  constructor() {\n    //Busca adcionadas ao constructor para evitar pecorrer o DOM\n    //bind para manter o contexto do this em document\n    const $ = document.querySelector.bind(document);\n\n    //elementos HTML\n    this._inputData = $(\"#data\");\n    this._inputQuantidade = $(\"#quantidade\");\n    this._inputValor = $(\"#valor\");\n\n    // this._negociacoes = ProxyFactory.create(\n    //   new Negociacoes(),\n    //   [\"adiciona\", \"esvazia\"],\n    //   model => this._negociacoesView.update(model)\n    // );\n    // this._negociacoesView = new NegociacoesView(\"#negociacoes\");\n    // this._negociacoesView.update(this._negociacoes);\n\n    this._negociacoes = new Bind(\n      new Negociacoes(),\n      new NegociacoesView(\"#negociacoes\"),\n      \"adiciona\",\n      \"esvazia\"\n    );\n\n    // this._mensagem = ProxyFactory.create(new Mensagem(), [\"texto\"], model =>\n    //   this._mensagemView.update(model)\n    // );\n    // this._mensagemView = new MensagemView(\"#mensagemView\");\n    // this._mensagemView.update(this._mensagem);\n\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView(\"#mensagemView\"),\n      \"texto\"\n    );\n\n    this._service = new NegociacaoService();\n    this._init();\n  }\n  _init() {\n    getNegociacaoDao()\n      .then(dao => dao.listaTodos())\n      .then(negociacoes =>\n        negociacoes.forEach(negociacao =>\n          this._negociacoes.adiciona(negociacao)\n        )\n      )\n      .catch(err => (this._mensagem.texto = err));\n  }\n  adiciona(event) {\n    try {\n      //Previnir evento padrão\n      event.preventDefault();\n\n      const negociacao = this._criaNegociacao();\n\n      getNegociacaoDao()\n        .then(dao => dao.adciona(negociacao))\n        .then(() => {\n          this._negociacoes.adiciona(negociacao);\n          this._mensagem.texto = \"Negociação adicionada com Sucesso\";\n          this._limpaformulario();\n        });\n    } catch (error) {\n      console.log(error);\n      console.log(error.stack);\n      if (error instanceof DataInvalidaException) {\n        this._mensagem.texto = error.message;\n      } else {\n        this._mensagem.texto =\n          \"Um erro nao esperado aconteceu. Entre em contato com o suporte\";\n      }\n    }\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(\n      DateConverter.toDate(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value)\n    );\n  }\n\n  _limpaformulario() {\n    this._inputData.value = \"\";\n    this._inputQuantidade.value = 1;\n    this._inputValor.value = 0.0;\n    this._inputData.focus();\n  }\n\n  apaga() {\n    getNegociacaoDao()\n      .then(dao => dao.apagaTodos())\n      .then(() => {\n        this._negociacoes.esvazia();\n        this._mensagem.texto = \"Negociações Apagada com sucesso\";\n      })\n      .catch(err => (this._mensagem.texto = err));\n  }\n\n  importaNegociacoes() {\n    /* const listaNegociacoes = [];\n\n    this._service\n      .obterNegocicoesDaSemana()\n      .then(({ negociacoes }) => {\n        listaNegociacoes.push(...negociacoes);\n        return this._service.obterNegociacaoDaSemanaAnterior();\n      })\n      .then(({ negociacoes }) => {\n        listaNegociacoes.push(...negociacoes);\n        return this._service.obterNegociacoesDaSemanaRetrasada();\n      })\n      .then(({ negociacoes, mensagem }) => {\n        listaNegociacoes.push(...negociacoes);\n\n        listaNegociacoes.forEach(negociacao =>\n          this._negociacoes.adiciona(negociacao)\n        );\n        this._mensagem.texto = mensagem;\n      })\n      .catch(err => (this._mensagem.texto = err));*/\n    // Promise.all([\n    //   this._service.obterNegocicoesDaSemana(),\n    //   this._service.obterNegociacoesDaSemanaAnterior(),\n    //   this._service.obterNegociacoesDaSemanaRetrasada()\n    // ])\n    //   .then(periodo => {\n    //     periodo = periodo\n    //       .reduce((novoArray, item) => novoArray.concat(item.negociacoes), [])\n    //       .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n    //   })\n    //   .catch(err => (this._mensagem.texto = err));\n\n    this._service\n      .obtemNegociacoesDoPeriodo()\n      .then(negociacoes => {\n        negociacoes\n          .filter(\n            novaNegociacao =>\n              !this._negociacoes\n                .paraArray()\n                .some(negociacaoExistente =>\n                  novaNegociacao.equals(negociacaoExistente)\n                )\n          )\n          .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n        this._mensagem.texto = \"Negociações do período importadas com sucesso\";\n      })\n      .catch(err => (this._mensagem.texto = err));\n  }\n}\n"]}